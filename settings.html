<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Paramètres - Kids Tasks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="nav-left">
      <button class="menu-toggle" onclick="toggleMenu()">🍔</button>
      <nav id="navMenu">
        <a href="index.html">🏠 Accueil</a>
        <a href="settings.html">⚙️ Paramètres</a>
        <a href="about.html">ℹ️ À propos</a>
        <a href="install.html">📲 Installer</a>
      </nav>
    </div>
    <button class="toggle-dark" onclick="toggleDarkMode()">🌙/☀️</button>
  </header>

  <main>
    <h2>⚙ Paramètres globaux</h2>
    <div id="childrenSettings"></div>
    <div class="actions">
      <button class="btn" onclick="ajouterEnfant()">➕ Ajouter un enfant</button>
      <button class="btn" onclick="sauver()">💾 Enregistrer</button>
    </div>
  </main>

  <script>
    /* 🌙 Dark mode */
    if(window.matchMedia('(prefers-color-scheme: dark)').matches)
      document.body.classList.add("dark");
    if(localStorage.getItem("darkMode")==="true")
      document.body.classList.add("dark");
    function toggleDarkMode(){
      document.body.classList.toggle("dark");
      localStorage.setItem("darkMode",document.body.classList.contains("dark"));
    }

    /* Menu responsive */
    function toggleMenu(){
      document.getElementById("navMenu").classList.toggle("show");
    }

    /* Charger enfants */
    let children=JSON.parse(localStorage.getItem("children"))||[
      {settings:{childName:"Enfant 1",currency:"€",thresholdMin:10,thresholdMid:13,thresholdMax:16,rewardMid:8,rewardMax:12},
       tasks:["Tâche 1","Tâche 2","Tâche 3"],notes:{},history:[]}
    ];

    const cont=document.getElementById("childrenSettings");

    function render(){
      cont.innerHTML="";
      children.forEach((c,i)=>{
        const card=document.createElement("div");
        card.className="child-card";
        card.innerHTML=`
          <h3>${c.settings.childName||("Enfant "+(i+1))} 
            <button class="btn btn-danger" onclick="supprimerEnfant(${i})">🗑 Supprimer</button>
          </h3>

          <div class="form-row"><label>Nom :</label><input type="text" id="name-${i}" value="${c.settings.childName}"></div>
          <div class="form-row"><label>Devise :</label><input type="text" id="currency-${i}" value="${c.settings.currency}"></div>
          <div class="form-row"><label>Seuil minimum :</label><input type="number" id="min-${i}" value="${c.settings.thresholdMin}"></div>
          <div class="form-row"><label>Seuil intermédiaire :</label><input type="number" id="mid-${i}" value="${c.settings.thresholdMid}"></div>
          <div class="form-row"><label>Seuil maximum :</label><input type="number" id="max-${i}" value="${c.settings.thresholdMax}"></div>
          <div class="form-row"><label>Récompense intermédiaire :</label><input type="number" id="rMid-${i}" value="${c.settings.rewardMid}"></div>
          <div class="form-row"><label>Récompense maximum :</label><input type="number" id="rMax-${i}" value="${c.settings.rewardMax}"></div>
        `;
        cont.appendChild(card);
      });
    }

    function ajouterEnfant(){
      children.push({
        settings:{childName:"Nouvel enfant",currency:"€",thresholdMin:10,thresholdMid:13,thresholdMax:16,rewardMid:8,rewardMax:12},
        tasks:["Tâche 1","Tâche 2"],notes:{},history:[]
      });
      render();
    }

    function supprimerEnfant(i){
      if(confirm("Supprimer cet enfant ?")){
        children.splice(i,1);
        render();
      }
    }

    function sauver(){
      children.forEach((c,i)=>{
        c.settings.childName=document.getElementById("name-"+i).value;
        c.settings.currency=document.getElementById("currency-"+i).value;
        c.settings.thresholdMin=parseFloat(document.getElementById("min-"+i).value)||10;
        c.settings.thresholdMid=parseFloat(document.getElementById("mid-"+i).value)||13;
        c.settings.thresholdMax=parseFloat(document.getElementById("max-"+i).value)||16;
        c.settings.rewardMid=parseFloat(document.getElementById("rMid-"+i).value)||8;
        c.settings.rewardMax=parseFloat(document.getElementById("rMax-"+i).value)||12;
      });
      localStorage.setItem("children",JSON.stringify(children));
      alert("✅ Paramètres sauvegardés !");
    }

    render();
  </script>
</body>
</html>
